@mixin grid($cols, $name-prefix: 'x', $name-ext: null,
            $multiple: 1, $breakpoint: null) {
  @for $x from 1 through $cols {
    @include grid-column($x, $cols, $name-prefix, $name-ext, $multiple,
                         $breakpoint);
  }
}


@if not global-variable-exists(-column-cache) {
  $-column-cache: () !global;
}


@mixin grid-column($x, $cols, $name-prefix: 'x', $name-ext: null, $multiple: 1,
                   $breakpoint: null) {
  @if $name-ext {
    $name-ext: "--#{$name-ext}";
  } @else {
    $name-ext: '';
  }

  $-width: ($x / $cols) * $multiple;
  @if $-width > 1 {
    $-width: 1;
  }
  $column-name: 'column--#{$-width}--#{$cols}--#{$breakpoint}';
  $column-cached: true;

  @if not index($-column-cache, $column-name) {
    $-column-cache: append($-column-cache, $column-name) !global;
    $column-cached: false;
  }

  @if $column-cached == false {
    %#{$column-name} {
      @include make-grid-column($x, $cols, $multiple);
    }
  }

  .#{$name-prefix}#{$x}#{$name-ext} {
    @extend %#{$column-name};
  }
}


@mixin make-grid-column($n, $columns, $multiple: 1) {
  $width: ($n / $columns) * $multiple;
  @if $width > 1 {
    $width: 1;
  }
  $width: percentage($width);
  width: $width;
  @include flex-basis($width);
}
